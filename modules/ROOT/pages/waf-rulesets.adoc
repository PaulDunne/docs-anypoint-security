= WAF Rulesets

You can enable rules by threat category for requests and responses--these are called "rulesets." Custom rules or modifications to rules are not currently available. There is an option to disable individual rules within a ruleset if they are causing false positives. See xref:create-waf-policy#disable_rules[Disable Individual Rules].

Rules can run on a variety of things, for example, they can run on URIs, headers, arguments, session IDs, cookies, and request and response bodies, to name a few.

For optimal performance, you should enable only the rules that apply to your web application's technology.

[[request_rule_sets]]
== Request Rulesets

Request rulesets are divided into ten threat categories, which are called rulesets. There are three actions that can be selected for each ruleset:

* *Disable ruleset* - (Default) Ruleset detection is turned off.
* *Detect and allow violations* - The violation is detected and you will get information in your logs at the INFO level, per incident. +
They will also be included at the ERROR (default log level for Edge policies) level in a summary report. +
You can change log levels for your security policies in Runtime Fabric *Logs* settings. See xref:1.0@runtime-fabric::index.adoc[the Runtime Fabric documentation].
* *Detect and reject violations* - The request is rejected and has a response status of `400 - BAD REQUEST`.

The ten threat categories include the following:

* *Scanner detection*
* *Protocol enforcement*
* *Protocol attack*
* *Local file inclusion*
* *Remote file inclusion*
* *Remote code execution*
* *PHP injection*
* *Cross-site scripting*
* *SQL injection*
* *Session fixation*

[[response_rule_sets]]
== Response Rule Sets

Response rulesets are similar to request rulesets. Response rulesets check outbound responses from backend servers to look for information that should not be present in responses.

The response rulesets are again divided into threat categories. The same actions apply as with the request ruleset--disable ruleset, disable and reject violations, and disable and allow violations. These have the same meaning as they do in the request ruleset.

The threat categories for the response ruleset include:

* *Data leakages*
* *SQL data leakages*
* *Java data leakages*
* *PHP data leakages*
* IIS data leakages*

== View Rules in RAML

You can understand the regular expressions that make up each rule by viewing the rules in the Security Fabric RAML (`security-fabric-policies-api-<version>.raml`). Not all OWASP CRS rules for each category are enabled for the WAF policy. A very small number of them are not included for various reasons. View the RAML for the exact contents and rule IDs that are included.

. Go to Exchange.
. Download the security-fabric-policies-api-<version>raml.zip.
. Extract the ZIP files.
. Navigate to ``<Download_location>/security-fabric-policies-api-<version>-raml 3/dataTypes/policies/WafRules/Rulesets.json`.

== Runtime Fabric Policy Summary

The Runtime Fabric policy summary includes the WAF summary. A WAF summary log message is generated every five minutes. The contents in the raw log message include WAF and DoS summary statistics.

For example:

----
<logType>INPUT_SERVER</logType><logLevel>INFO</logLevel><process>securityfabric-edge-runtime</process><pid>4177</pid><tid>4198</tid><file>/edge/cbrcore/src/rtc/embedded/http_is/HttpInputServer.cpp</file><line>2692</line></header><body><rtfSecurityPolicySummary>{"timeStamp":"2018-12-04T01:50:00.376Z","node":"vm14.example.com","dosSummary":{"intervalErrors":{"protocolErrors":0,"routingErrors":0,"contentErrors":0,"authenticationErrors":0,"qosErrors":0,"WAF Errors":63194},"intervalActionsTaken":{"shapeInterval":5,"shapeForever":0,"blockInterval":0,"blockForever":0},"numCurrentlyBlockedAndShapedIps":{"shapeInterval":1,"shapeForever":0,"blockInterval":0,"blockForever":0}},"capSummary":{"intervalRequestsRejected":{"requestsRejected":0}},"aclSummary":{"intervalRequestsRejected":{"requestsRejected":0}},"wafSummary":{"ruleTriggerCounts":{"933120":0,"920320":0,"954100":0,"941300":0,"951150":0,"942190":0,"920430":0,"942251":0,"951260":0,"942300":0,"920272":0,"942410":0,"941130":0,"932170":0,"920260":0,"930110":0,"921150":0,"941240":0,"942130":0,"933170":0,"920370":0,"941350":0,"931110":0,"951200":0,"942240":0,"920273":0,"942350":0,"932110":0,"932171":0,"920200":0,"921151":0,"941180":0,"942460":0,"933110":0,"920310":0,"941290":0,"951140":0,"942180":0,"920420":0,"951250":0,"942290":0,"920274":0,"920140":0,"920201":0,"942400":0,"941120":0,"932160":0,"920250":0,"933111":0,"920311":0,"930100":0,"921140":0,"941230":0,"942120":0,"933160":0,"920360":0,"941340":0,"931100":0,"951190":0,"942230":0,"943120":0,"920202":0,"942340":0,"932100":0,"920190":0,"950130":0,"942450":0,"941170":0,"933100":0,"920300":0,"933161":0,"941280":0,"913120":0,"951130":0,"942170":0,"920410":0,"951240":0,"942280":0,"920130":1,"942390":0,"941110":0,"932150":0,"920240":0,"921130":0,"941220":0,"942110":0,"933150":0,"920350":0,"954130":0,"941330":0,"951180":0,"942220":0,"920460":0,"943110":0,"942330":0,"920180":0,"942440":0,"941160":0,"920290":0,"933151":0,"921180":0,"941270":0,"913110":0,"932115":0,"951120":0,"942160":0,"920400":0,"951230":0,"942270":0,"920120":0,"942380":0,"941100":0,"932140":0,"920230":0,"953120":0,"921120":0,"941210":0,"942100":0,"933140":0,"920340":0,"954120":0,"941320":0,"951170":0,"942210":0,"920450":0,"943100":0,"920121":0,"942320":0,"941101":0,"920170":0,"942430":0,"941150":0,"920280":0,"930130":0,"941260":0,"913100":0,"932105":0,"951110":0,"942150":0,"920390":0,"931130":0,"951220":0,"942260":0,"952110":0,"942370":0,"932130":0,"942431":0,"920220":0,"953110":0,"921110":0,"941200":0,"913101":0,"933130":0,"920330":0,"954110":0,"941310":0,"951160":0,"942200":0,"920440":0,"942310":0,"942432":0,"920160":0,"950100":0,"941140":0,"942420":0,"920270":0,"913102":0,"933131":0,"930120":0,"921160":0,"941250":0,"942140":0,"933180":0,"920380":0,"931120":0,"951210":0,"942250":0,"952100":0,"920100":0,"942360":0,"932120":0,"942421":0,"920210":63193,"920271":0,"953100":0,"921100":0,"941190":0}}}</rtfSecurityPolicySummary></body></logEntry>
----

If you format the raw data in JSON, from this example, you can see that rule 920210 has fired 63,193 times and that rule 920130 has fired one time.
