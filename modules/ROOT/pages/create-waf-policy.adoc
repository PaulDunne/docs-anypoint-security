= Create a WAF Policy

Under the “Anypoint Security”->Security Policies, you will now be able to create a new policy type called, WAF.

. Sign into Anypoint Platform and navigate to Anypoint Security.
. In the Security Policies page, click *Create Policy* and select *Web Application Firewall (WAF)*.
. Enter a name for the policy and click *Save*. +
The policy appears in the Security Policies list, where you can edit and delete policies.

image::security-policy-list.png[]

== Configure Request Rulesets

Configure the rules to allow or block request traffic to your Web application. For more information about request rulesets, see xref:waf-rulesets#request_rule_sets[Request rulesets].

. In the menu on the left, click *Request Rulesets*. +
All the rules are disabled by default. For each rule, you can: +
* *Disable ruleset* - (Default) Ruleset detection is turned off.
* *Detect and allow violations* - The violation is detected but not reported to DoS.
* *Detect and reject violations* - The request is rejected and has a response status of `400 - BAD REQUEST`.
. In *Advanced performance options*, you can select from the following options: +
* *Disable body scanner* - If you do not check this option, the request body is scanned.
+
[NOTE]
Leaving the *Disable body scanner* option unchecked can be costly in terms of resources (CPU) depending on the size of the request messages. If request body checking is enabled, the CAP policy “Maximum Message Size” should be set to a value no larger than required to prevent attackers from abusing request body checking, and exhausting the resources.
//* *Disable JSON parser*
//* *Disable XML parser* +
When you hover over the `i` button to the right of each rule, the rule ID range for that rule is displayed.
+
image::waf-hover-for-rule.png[]
. Click *Save*.

== Configure Response Rulesets

Configure the rules to allow or block responses to your Web application. For more information about response rulesets, see xref:waf-rulesets#response_rule_sets[Response rulesets]

. In the menu on the left, click *Response Rulesets*. +
All the rulesets are disabled by default. For each rule, you can: +
* *Disable ruleset* - (Default) Ruleset detection is turned off.
* *Detect and allow violations* - The violation is detected but not reported to DoS.
* *Detect and reject violations* - The request is rejected and has a response status of `400 - BAD REQUEST`.
. In *Advanced Performance Options*, select *Disable body scanner* to improve performance. +
The *Disable body scanner* works as explained for the request ruleset, however, there are some important caveats:

* Only the following MIME types are evaluated:
** text/plain
** text/html
** text/xml
** application/json +
Response messages without these MIME types set in the content type header will not be evaluated.
* For resource usage management, a maximum response size is imposed, which is hard-coded to 512 KB and not configurable. If response rulesets are enabled with the “Disable body scanner” unchecked, a response with a content-length greater than 512 KB will be rejected. +
[Important]
Do not leave the *Disable body scanner* option unchecked if responses will exceed 512 KB.
. Click *Save*.

[[disable_rules]]
== Disable Individual Rules

You can disable individual rules within a ruleset if they are causing false positives. This is useful because if only one rule ID in the ruleset is causing a false positive, it isn't necessary to turn off an entire ruleset such as “Protocol attack."

You can examine the WAF summary message in logs to determine which rule IDs are firing. You can also refer to the Edge policies RAML for a complete list of rule IDs.

. In the *Anypoint Security > Security Policies* page, click *Edit* for the WAF policy for which to disable rules.
. In the menu on the left, click *Disabled Rule IDs*.
. Add the individual rule IDs for the rules to disable, separated by commas. +
. Click *Save*.

== See Also

* xref:apply-policy.adoc[Applying Policies]
* xref:waf-rulesets.adoc[WAF Rulesets]
